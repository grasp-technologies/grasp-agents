# Grasp Agents

<br/>
<svg width="320" height="118" viewBox="0 0 62 23" xmlns="http://www.w3.org/2000/svg">
  <style>
    path { fill: black; }
    @media (prefers-color-scheme: dark) {
      path { fill: white; }
    }
  </style>
<path d="M8.954 17.44C4.334 17.44 0.66 14.096 0.66 8.97C0.66 3.844 4.334 0.499999 8.954 0.499999C10.472 0.499999 12.628 0.851999 14.674 1.424V5.956L13.662 6.066C12.342 2.876 10.89 1.776 8.954 1.776C6.666 1.776 4.972 4.152 4.972 8.97C4.972 13.788 6.666 16.164 8.954 16.164C9.79 16.164 10.67 15.812 11.484 15.13V11.478C11.484 10.246 11.264 9.982 10.076 9.872L8.932 9.762V8.662H16.94V9.762L16.456 9.806C15.73 9.872 15.488 10.18 15.488 11.478V15.878C13.398 16.846 11.176 17.44 8.954 17.44ZM18.0357 17V15.9L18.5197 15.856C19.0037 15.812 19.1797 15.57 19.1797 14.844V9.74C19.1797 9.036 18.9817 8.772 18.5197 8.728L18.0357 8.684V7.628L22.6117 6.22C22.6997 6.22 22.7437 6.264 22.7437 6.352V8.332C23.6897 6.858 24.6797 6.22 25.7357 6.22C26.9457 6.22 27.8917 6.99 27.8917 8.288C27.8917 9.366 27.1217 10.114 26.1317 10.114C24.9217 10.114 24.7017 8.904 24.0637 8.904C23.6677 8.904 23.2057 9.234 22.7437 10.114V14.69C22.7437 15.394 22.9197 15.658 23.5797 15.724L25.1197 15.9V17H18.0357ZM36.7931 17.088C35.6491 17.088 34.8791 16.714 34.5051 15.966C33.4931 16.956 32.5251 17.308 31.3591 17.308C29.4891 17.308 28.2131 16.252 28.2131 14.58C28.2131 12.622 29.7751 11.302 34.2411 10.642V9.762C34.2411 8.024 33.7571 7.496 33.0311 7.496C32.4371 7.496 32.1291 7.782 32.1291 8.288C32.1291 8.64 32.3051 8.926 32.3051 9.322C32.3051 10.048 31.7111 10.686 30.6771 10.686C29.4011 10.686 28.7411 10.048 28.7411 8.97C28.7411 7.518 30.3691 6.22 33.3171 6.22C36.7711 6.22 37.8051 7.54 37.8051 10.158V14.514C37.8051 15.526 37.9591 15.746 38.5311 15.834L38.9491 15.9V17C38.0691 17.066 37.6291 17.088 36.7931 17.088ZM31.7771 13.81C31.7771 14.712 32.3271 15.218 33.1191 15.218C33.5151 15.218 33.8011 15.108 34.2411 14.734V14.58V11.918C32.3491 12.292 31.7771 12.864 31.7771 13.81ZM44.3881 17.308C43.1781 17.308 41.3521 16.89 39.8781 16.164V13.106L40.9341 12.996C41.9681 15.042 43.4201 16.076 45.0481 16.076C45.8841 16.076 46.3021 15.746 46.3021 15.086C46.3021 13.282 40.0101 13.546 40.0101 9.344C40.0101 7.496 41.5281 6.22 44.0361 6.22C45.3121 6.22 46.3901 6.396 47.5561 6.704L47.8861 9.784L46.8081 9.894C46.0161 8.354 44.7401 7.452 43.3761 7.452C42.6061 7.452 42.1661 7.76 42.1661 8.222C42.1661 10.048 48.5021 9.674 48.5021 13.744C48.5021 16.01 46.8741 17.308 44.3881 17.308ZM49.3424 22.808V21.708L49.8264 21.664C50.3104 21.62 50.4864 21.378 50.4864 20.652V9.74C50.4864 9.036 50.2884 8.772 49.8264 8.728L49.3424 8.684V7.628L53.9184 6.22C54.0064 6.22 54.0504 6.264 54.0504 6.352V7.584C55.0184 6.726 56.0084 6.22 57.0864 6.22C59.7044 6.22 61.3544 8.024 61.3544 10.994C61.3544 15.218 58.4944 17.308 55.1724 17.308C54.7764 17.308 54.4244 17.286 54.0504 17.22V20.652C54.0504 21.312 54.1824 21.444 54.7104 21.51L56.4264 21.708V22.808H49.3424ZM54.0504 14.976C54.7104 15.746 55.3044 16.032 55.8324 16.032C57.1304 16.032 57.7904 15.108 57.7904 12.424C57.7904 9.718 56.7124 8.42 55.4364 8.42C54.8644 8.42 54.4684 8.618 54.0504 8.97V14.976Z" />
</svg>

<br/>
<br/>

[![PyPI version](https://badge.fury.io/py/grasp_agents.svg)](https://badge.fury.io/py/grasp-agents)
[![License: MIT](https://img.shields.io/badge/license-MIT-yellow?style=flat-square)](https://mit-license.org/)
[![PyPI downloads](https://img.shields.io/pypi/dm/grasp-agents?style=flat-square)](https://pypi.org/project/grasp-agents/)
[![GitHub Stars](https://img.shields.io/github/stars/grasp-technologies/grasp-agents?style=social)](https://github.com/grasp-technologies/grasp-agents/stargazers)
[![GitHub Forks](https://img.shields.io/github/forks/grasp-technologies/grasp-agents?style=social)](https://github.com/grasp-technologies/grasp-agents/network/members)

## Overview

**Grasp Agents** is a modular Python framework for building agentic AI pipelines and applications. It is meant to be minimalistic but functional, allowing for rapid experimentation while keeping full and granular low-level control over prompting, LLM handling, and inter-agent communication by avoiding excessive higher-level abstractions.

## Features

- Clean formulation of agents as generic entities over:
  - I/O schemas
  - Agent state
  - Shared context
- Transparent implementation of common agentic patterns:
  - Single-agent loops with an optional "ReAct mode" to enforce reasoning between the tool calls
  - Workflows (static communication topology), including loops
  - Agents-as-tools for task delegation
  - Freeform A2A communication via in-process Actor model
- Batch processing support outside of agentic loops
- Simple logging and usage/cost tracking

## Project Structure

- `base_agent.py`, `llm_agent.py`, `comm_agent.py`: Core agent class implementations.
- `agent_message.py`, `agent_message_pool.py`: Messaging and message pool management.
- `llm_agent_state.py`: State management for LLM agents.
- `tool_orchestrator.py`: Orchestration of tools used by agents.
- `prompt_builder.py`: Tools for constructing prompts.
- `workflow/`: Modules for defining and managing agent workflows.
- `cloud_llm.py`, `llm.py`: LLM integration and base LLM functionalities.
- `openai/`: Modules specific to OpenAI API integration.
- `memory.py`: Memory management for agents (currently only message history).
- `run_context.py`: Context management for agent runs.
- `usage_tracker.py`: Tracking of API usage and costs.
- `costs_dict.yaml`: Dictionary for cost tracking (update if needed).
- `rate_limiting/`: Basic rate limiting tools.

## Quickstart & Installation Variants (UV Package manager)

> **Note:** You can check this sample project code in the [src/grasp_agents/examples/demo/uv](src/grasp_agents/examples/demo/uv) folder. Feel free to copy and paste the code from there to a separate project. There are also [examples](src/grasp_agents/examples/demo/) for other package managers.

#### 1. Prerequisites

Install the [UV Package Manager](https://github.com/astral-sh/uv):

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### 2. Create Project & Install Dependencies

```bash
mkdir my-test-uv-app
cd my-test-uv-app
uv init .
```

Create and activate a virtual environment:

```bash
uv venv
source .venv/bin/activate
```

Add and sync dependencies:

```bash
uv add grasp_agents
uv sync
```

#### 3. Example Usage

Ensure you have a `.env` file with your OpenAI and Google AI Studio API keys set

```
OPENAI_API_KEY=your_openai_api_key
GOOGLE_AI_STUDIO_API_KEY=your_google_ai_studio_api_key
```

Create a script, e.g., `problem_recommender.py`:

```python
import re
from typing import Any
from pathlib import Path
from pydantic import BaseModel, Field
from dotenv import load_dotenv
from grasp_agents.typing.tool import BaseTool
from grasp_agents.typing.io import AgentPayload
from grasp_agents.run_context import RunContextWrapper
from grasp_agents.openai.openai_llm import OpenAILLM, OpenAILLMSettings
from grasp_agents.llm_agent import LLMAgent
from grasp_agents.grasp_logging import setup_logging
from grasp_agents.typing.message import Conversation

load_dotenv()


# Configure the logger to output to the console and/or a file
setup_logging(
    logs_file_path="grasp_agents_demo.log",
    logs_config_path=Path().cwd() / "configs/logging/default.yaml",
)

sys_prompt_react = """
Your task is to suggest an exciting stats problem to a student.
Ask the student about their education, interests, and preferences, then suggest a problem tailored to them.

# Instructions
* Ask questions one by one.
* Provide your thinking before asking a question and after receiving a reply.
* The problem must be enclosed in <PROBLEM> tags.
"""


class TeacherQuestion(BaseModel):
    question: str = Field(..., description="The question to ask the student.")

StudentReply = str


class AskStudentTool(BaseTool[TeacherQuestion, StudentReply, Any]):
    name: str = "ask_student_tool"
    description: str = "Ask the student a question and get their reply."
    in_schema: type[TeacherQuestion] = TeacherQuestion
    out_schema: type[StudentReply] = StudentReply

    async def run(
        self, inp: TeacherQuestion, ctx: RunContextWrapper[Any] | None = None
    ) -> StudentReply:
        return input(inp.question)


class FinalResponse(AgentPayload):
    problem: str


teacher = LLMAgent[Any, FinalResponse, None](
    agent_id="teacher",
    llm=OpenAILLM(
        model_name="gpt-4.1",
        api_provider="openai",
        llm_settings=OpenAILLMSettings(temperature=0.1),
    ),
    tools=[AskStudentTool()],
    max_turns=20,
    react_mode=True,
    sys_prompt=sys_prompt_react,
    out_schema=FinalResponse,
    set_state_strategy="reset",
)


@teacher.tool_call_loop_exit_handler
def exit_tool_call_loop(conversation: Conversation, ctx, **kwargs) -> None:
    message_text = conversation[-1].content

    return re.search(r"<PROBLEM>", message_text)


@teacher.parse_output_handler
def parse_output(conversation: Conversation, ctx, **kwargs) -> FinalResponse:
    message_text = conversation[-1].content
    matches = re.findall(r"<PROBLEM>(.*?)</PROBLEM>", message_text, re.DOTALL)

    return FinalResponse(problem=matches[0])


async def main():
    ctx = RunContextWrapper(print_messages=True)
    out = await teacher.run(ctx=ctx)
    print(out.payloads[0].problem)
    print(ctx.usage_tracker.total_usage)


asyncio.run(main())
```

Run your script:

```bash
uv run problem_recommender.py
```

You can find more examples in [src/grasp_agents/examples/notebooks/agents_demo.ipynb](src/grasp_agents/examples/notebooks/agents_demo.ipynb).
